        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            try {
                console.log('üöÄ Initializing Sleepover Cards Editor...');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
                loadFromLocalStorage();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
                initMultiSelect();
                attachEventListeners();
                updateStats();
                
                // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é
                if (cardsData.length === 0) {
                    console.log('üìù No cards found, creating first card...');
                    addNewCard();
                } else {
                    console.log('üìã Cards loaded from localStorage:', cardsData.length);
                }
                
                console.log('‚úÖ Sleepover Cards Editor initialized successfully!');
                console.log('üîß Available functions:', {
                    addNewCard: '–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É',
                    selectCard: '–í—ã–±—Ä–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ –∏–Ω–¥–µ–∫—Å—É',
                    deleteCard: '–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ –∏–Ω–¥–µ–∫—Å—É',
                    validateCard: '–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É',
                    saveToLocalStorage: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage',
                    loadFromLocalStorage: '–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage'
                });
                
            } catch (error) {
                console.error('üí• Initialization Error:', error);
                alert('–û—à–∏–±–∫–∞<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleepover Cards Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 300px 1fr 400px;
            gap: 0;
            min-height: 700px;
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .cards-sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 20px;
            overflow-y: auto;
            max-height: 700px;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }

        .add-card-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-card-btn:hover {
            background: #218838;
        }

        .cards-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .card-item {
            padding: 12px;
            background: white;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .card-item:hover {
            border-color: #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card-item.active {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .card-item.invalid {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .card-preview {
            font-size: 13px;
            line-height: 1.4;
        }

        .card-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 11px;
            color: #666;
        }

        .card-text {
            color: #333;
            font-weight: 500;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-tags {
            font-size: 10px;
            color: #888;
        }

        .delete-card {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card-item:hover .delete-card {
            opacity: 1;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å - —Ä–µ–¥–∞–∫—Ç–æ—Ä */
        .editor-section {
            padding: 30px;
            overflow-y: auto;
            max-height: 700px;
        }

        .section-title {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 25px;
            font-weight: 600;
            border-bottom: 3px solid #ff6b6b;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.95em;
        }

        .form-group.required label::after {
            content: ' *';
            color: #dc3545;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group.error input,
        .form-group.error select,
        .form-group.error textarea {
            border-color: #dc3545;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .form-group.error .error-message {
            display: block;
        }

        .multi-select {
            position: relative;
        }

        .multi-select-container {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            min-height: 44px;
            padding: 8px;
            cursor: pointer;
            background: white;
        }

        .multi-select-container:focus-within {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .selected-item {
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .selected-item .remove {
            cursor: pointer;
            font-weight: bold;
        }

        .dropdown-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e9ecef;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .dropdown-options.active {
            display: block;
        }

        .dropdown-option {
            padding: 10px;
            cursor: pointer;
            border-bottom: 1px solid #f1f3f4;
        }

        .dropdown-option:hover {
            background: #f8f9fa;
        }

        .dropdown-option.selected {
            background: #e3f2fd;
            color: #1976d2;
        }

        .subsection {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ff6b6b;
        }

        .subsection h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.1em;
        }

        /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - JSON */
        .json-section {
            background: #f8f9fa;
            padding: 30px;
            border-left: 1px solid #e9ecef;
            display: flex;
            flex-direction: column;
        }

        .json-output {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            overflow-x: auto;
            flex: 1;
            border: none;
            resize: none;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .toolbar {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-info {
            background: #17a2b8;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .file-input {
            margin-bottom: 20px;
        }

        .file-input input[type="file"] {
            display: none;
        }

        .file-input label {
            display: inline-block;
            padding: 12px 24px;
            background: #17a2b8;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .file-input label:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats {
            padding: 15px;
            background: white;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stats-item {
            margin: 5px 0;
            font-size: 14px;
        }

        .stats-number {
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
            
            .cards-sidebar {
                max-height: 200px;
            }
        }

        .no-card-selected {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 400px;
            color: #666;
            text-align: center;
        }

        .no-card-selected h3 {
            margin-bottom: 10px;
            font-size: 1.5em;
        }

        .validation-summary {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .validation-summary h4 {
            color: #856404;
            margin-bottom: 10px;
        }

        .validation-summary ul {
            color: #856404;
            margin-left: 20px;
        }

        .validation-summary li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üåô Sleepover Cards Editor</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã—Ö –≤–µ—á–µ—Ä–∏–Ω–æ–∫</p>
        </div>

        <div class="main-layout">
            <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
            <div class="cards-sidebar">
                <div class="sidebar-header">
                    <h3 class="sidebar-title">–ö–∞—Ä—Ç–æ—á–∫–∏</h3>
                    <button class="add-card-btn" id="addCardBtn" title="–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">+</button>
                </div>

                <div class="stats">
                    <div class="stats-item">–í—Å–µ–≥–æ: <span class="stats-number" id="totalCards">0</span></div>
                    <div class="stats-item">–í–∞–ª–∏–¥–Ω—ã—Ö: <span class="stats-number" id="validCards">0</span></div>
                    <div class="stats-item">–° –æ—à–∏–±–∫–∞–º–∏: <span class="stats-number" id="invalidCards">0</span></div>
                </div>

                <div class="file-input">
                    <label for="jsonFile">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å JSON</label>
                    <input type="file" id="jsonFile" accept=".json">
                </div>

                <div class="cards-list" id="cardsList">
                    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å - —Ä–µ–¥–∞–∫—Ç–æ—Ä -->
            <div class="editor-section">
                <div id="noCardSelected" class="no-card-selected">
                    <h3>üé≠ –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é</p>
                </div>

                <div id="cardEditor" style="display: none;">
                    <h2 class="section-title">–†–µ–¥–∞–∫—Ç–æ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏</h2>
                    
                    <div id="validationSummary" class="validation-summary" style="display: none;">
                        <h4>‚ö†Ô∏è –ù–∞–π–¥–µ–Ω—ã –æ—à–∏–±–∫–∏:</h4>
                        <ul id="validationList"></ul>
                    </div>

                    <form id="cardForm">
                        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è -->
                        <div class="subsection">
                            <h3>üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                            
                            <div class="form-group">
                                <label for="id">ID (UUID - –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)</label>
                                <input type="text" id="id" readonly style="background: #f8f9fa;">
                            </div>

                            <div class="form-group required">
                                <label for="catalog_id">Catalog ID</label>
                                <input type="text" id="catalog_id">
                                <div class="error-message">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
                            </div>

                            <div class="form-group required">
                                <label for="set_id">Set ID</label>
                                <select id="set_id">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä --</option>
                                    <option value="4-iyulya">4-iyulya</option>
                                    <option value="first-vibes">first-vibes</option>
                                    <option value="crush-chronicles">crush-chronicles</option>
                                    <option value="digital-drama">digital-drama</option>
                                    <option value="spill-everything">spill-everything</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä</div>
                            </div>

                            <div class="form-group required">
                                <label for="category">Category</label>
                                <select id="category">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>
                                    <option value="experience">Experience (–ë—ã–ª–æ/–ù–µ –±—ã–ª–æ)</option>
                                    <option value="vote">Vote (–≠—Ç–æ —è/–ù–µ —è)</option>
                                    <option value="challenge">Challenge (–°–¥–µ–ª–∞–ª–∞/–ü–∞—Å)</option>
                                    <option value="story">Story (–†–∞—Å—Å–∫–∞–∑–∞–ª–∞/–ú–æ–ª—á—É)</option>
                                    <option value="match">Match (–°–æ–≤–ø–∞–ª–æ/–ù–µ —Å–æ–≤–ø–∞–ª–æ)</option>
                                    <option value="duel">Duel (–ü–æ–±–µ–¥–∏–ª–∞/–ü—Ä–æ–∏–≥—Ä–∞–ª–∞)</option>
                                    <option value="choice">Choice (–í—ã–±—Ä–∞–ª–∞/–°–ª–æ–∂–Ω–æ)</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</div>
                            </div>
                        </div>

                        <!-- Call to Action -->
                        <div class="subsection">
                            <h3>üî• –î–µ–π—Å—Ç–≤–∏—è</h3>
                            
                            <div class="form-group required">
                                <label for="primary">Primary Action</label>
                                <select id="primary">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ --</option>
                                    <option value="–ë—ã–ª–æ">–ë—ã–ª–æ</option>
                                    <option value="–≠—Ç–æ —è">–≠—Ç–æ —è</option>
                                    <option value="–°–¥–µ–ª–∞–ª–∞">–°–¥–µ–ª–∞–ª–∞</option>
                                    <option value="–†–∞—Å—Å–∫–∞–∑–∞–ª–∞">–†–∞—Å—Å–∫–∞–∑–∞–ª–∞</option>
                                    <option value="–°–æ–≤–ø–∞–ª–æ">–°–æ–≤–ø–∞–ª–æ</option>
                                    <option value="–ü–æ–±–µ–¥–∏–ª–∞">–ü–æ–±–µ–¥–∏–ª–∞</option>
                                    <option value="–í—ã–±—Ä–∞–ª–∞">–í—ã–±—Ä–∞–ª–∞</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
                            </div>

                            <div class="form-group required">
                                <label for="secondary">Secondary Action</label>
                                <select id="secondary">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ --</option>
                                    <option value="–ù–µ –±—ã–ª–æ">–ù–µ –±—ã–ª–æ</option>
                                    <option value="–ù–µ —è">–ù–µ —è</option>
                                    <option value="–ü–∞—Å">–ü–∞—Å</option>
                                    <option value="–ú–æ–ª—á—É">–ú–æ–ª—á—É</option>
                                    <option value="–ù–µ —Å–æ–≤–ø–∞–ª–æ">–ù–µ —Å–æ–≤–ø–∞–ª–æ</option>
                                    <option value="–ü—Ä–æ–∏–≥—Ä–∞–ª–∞">–ü—Ä–æ–∏–≥—Ä–∞–ª–∞</option>
                                    <option value="–°–ª–æ–∂–Ω–æ">–°–ª–æ–∂–Ω–æ</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
                            </div>
                        </div>

                        <!-- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã -->
                        <div class="subsection">
                            <h3>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
                            
                            <div class="form-group required">
                                <label for="depth">Depth (1-5)</label>
                                <input type="number" id="depth" min="1" max="5">
                                <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 1 –¥–æ 5</div>
                            </div>

                            <div class="form-group required">
                                <label for="spice">Spice (0-3)</label>
                                <input type="number" id="spice" min="0" max="3">
                                <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç 0 –¥–æ 3</div>
                            </div>

                            <div class="form-group required">
                                <label for="weight">Weight</label>
                                <input type="number" id="weight" min="0" step="0.1">
                                <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ</div>
                            </div>

                            <div class="form-group required">
                                <label for="target_player">Target Player</label>
                                <select id="target_player">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª—å --</option>
                                    <option value="left">Left</option>
                                    <option value="right">Right</option>
                                    <option value="random">Random</option>
                                    <option value="self">Self</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</div>
                            </div>
                        </div>

                        <!-- –¢–µ–∫—Å—Ç—ã -->
                        <div class="subsection">
                            <h3>üìù –¢–µ–∫—Å—Ç—ã</h3>
                            
                            <div class="form-group required">
                                <label for="text_ru">–¢–µ–∫—Å—Ç (RU)</label>
                                <textarea id="text_ru" rows="3"></textarea>
                                <div class="error-message">–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ</div>
                            </div>

                            <div class="form-group">
                                <label for="text_en">Text (EN)</label>
                                <textarea id="text_en" rows="3"></textarea>
                            </div>

                            <div class="form-group">
                                <label for="placeholders">Placeholders</label>
                                <input type="text" id="placeholders" placeholder="player, name, etc. (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
                            </div>
                        </div>

                        <!-- –¢–µ–≥–∏ -->
                        <div class="subsection">
                            <h3>üè∑Ô∏è –¢–µ–≥–∏</h3>
                            
                            <div class="form-group">
                                <label>Tone</label>
                                <div class="multi-select" data-field="tone">
                                    <div class="multi-select-container">
                                        <div class="selected-items"></div>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="light">Light</div>
                                        <div class="dropdown-option" data-value="deep">Deep</div>
                                        <div class="dropdown-option" data-value="flirt_light">Flirt Light</div>
                                        <div class="dropdown-option" data-value="nsfw_18">NSFW 18+</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Occasion</label>
                                <div class="multi-select" data-field="occasion">
                                    <div class="multi-select-container">
                                        <div class="selected-items"></div>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="–ø–∏–∫–Ω–∏–∫">–ü–∏–∫–Ω–∏–∫</div>
                                        <div class="dropdown-option" data-value="–≤ –¥–æ—Ä–æ–≥–µ">–í –¥–æ—Ä–æ–≥–µ</div>
                                        <div class="dropdown-option" data-value="—Å–≤–∏–¥–∞–Ω–∏–µ">–°–≤–∏–¥–∞–Ω–∏–µ</div>
                                        <div class="dropdown-option" data-value="–≤–µ—á–µ—Ä–∏–Ω–∫–∞">–í–µ—á–µ—Ä–∏–Ω–∫–∞</div>
                                        <div class="dropdown-option" data-value="–¥–æ–º–∞">–î–æ–º–∞</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Season</label>
                                <div class="multi-select" data-field="season">
                                    <div class="multi-select-container">
                                        <div class="selected-items"></div>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="4 –∏—é–ª—è">4 –∏—é–ª—è</div>
                                        <div class="dropdown-option" data-value="–Ω–æ–≤—ã–π –≥–æ–¥">–ù–æ–≤—ã–π –≥–æ–¥</div>
                                        <div class="dropdown-option" data-value="–ª–µ—Ç–æ">–õ–µ—Ç–æ</div>
                                        <div class="dropdown-option" data-value="–∑–∏–º–∞">–ó–∏–º–∞</div>
                                        <div class="dropdown-option" data-value="–≤–µ—Å–Ω–∞">–í–µ—Å–Ω–∞</div>
                                        <div class="dropdown-option" data-value="–æ—Å–µ–Ω—å">–û—Å–µ–Ω—å</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group required">
                                <label for="segment">Segment</label>
                                <select id="segment">
                                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç --</option>
                                    <option value="—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ</option>
                                    <option value="–ø–æ–¥—Ä–æ—Å—Ç–∫–∏">–ü–æ–¥—Ä–æ—Å—Ç–∫–∏</option>
                                    <option value="—Å—Ç—É–¥–µ–Ω—Ç—ã">–°—Ç—É–¥–µ–Ω—Ç—ã</option>
                                    <option value="–≤–∑—Ä–æ—Å–ª—ã–µ">–í–∑—Ä–æ—Å–ª—ã–µ</option>
                                </select>
                                <div class="error-message">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ–≥–º–µ–Ω—Ç</div>
                            </div>
                        </div>

                        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ -->
                        <div class="subsection">
                            <h3>üåç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ</h3>
                            
                            <div class="form-group">
                                <label>Countries Allow</label>
                                <div class="multi-select" data-field="countries_allow">
                                    <div class="multi-select-container">
                                        <div class="selected-items"></div>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="US">US</div>
                                        <div class="dropdown-option" data-value="RU">RU</div>
                                        <div class="dropdown-option" data-value="UK">UK</div>
                                        <div class="dropdown-option" data-value="CA">CA</div>
                                        <div class="dropdown-option" data-value="DE">DE</div>
                                        <div class="dropdown-option" data-value="FR">FR</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Languages</label>
                                <div class="multi-select" data-field="languages">
                                    <div class="multi-select-container">
                                        <div class="selected-items"></div>
                                    </div>
                                    <div class="dropdown-options">
                                        <div class="dropdown-option" data-value="ru">Russian</div>
                                        <div class="dropdown-option" data-value="en">English</div>
                                        <div class="dropdown-option" data-value="es">Spanish</div>
                                        <div class="dropdown-option" data-value="fr">French</div>
                                        <div class="dropdown-option" data-value="de">German</div>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group required">
                                <label for="min_age">Min Age</label>
                                <input type="number" id="min_age" min="7" max="25">
                                <div class="error-message">–í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 7 –¥–æ 25</div>
                            </div>

                            <div class="form-group">
                                <label for="notes">Notes</label>
                                <textarea id="notes" rows="3"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - JSON -->
            <div class="json-section">
                <h2 class="section-title">JSON Output</h2>
                <textarea id="jsonOutput" class="json-output" readonly></textarea>
            </div>
        </div>

        <div class="toolbar">
            <button type="button" class="btn btn-success" id="downloadBtn">üíæ –°–∫–∞—á–∞—Ç—å JSON</button>
            <button type="button" class="btn btn-secondary" id="copyBtn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å JSON</button>
            <button type="button" class="btn btn-info" id="downloadSingleBtn" disabled>üìÑ –°–∫–∞—á–∞—Ç—å —Ç–µ–∫—É—â—É—é –∫–∞—Ä—Ç–æ—á–∫—É</button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let cardsData = [];
        let currentCardIndex = -1;

        // –®–∞–±–ª–æ–Ω –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function createNewCard() {
            return {
                id: generateUUID(),
                catalog_id: '',
                set_id: '',
                category: '',
                call_to_action: {
                    primary: '',
                    secondary: ''
                },
                depth: 2,
                spice: 0,
                consent_required_level: 0,
                weight: 1,
                target_player: '',
                locale_text: {
                    ru: '',
                    en: ''
                },
                ab_variants_by_locale: {
                    ru: [],
                    en: []
                },
                tags: {
                    tone: ['light'],
                    occasion: [],
                    season: [],
                    segment: ['—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ']
                },
                eligibility: {
                    countries_allow: ['US'],
                    languages: ['ru', 'en'],
                    min_age: 7
                },
                seasonality: {
                    start_utc: '2025-06-25T00:00:00Z',
                    end_utc: '2025-07-10T23:59:59Z',
                    boost_weight: 2
                },
                nsfw_light: false,
                nsfw_18_plus: false,
                content_warnings: [],
                paywall: {
                    gated: true,
                    tier: null
                },
                status: 'approved',
                version: 2,
                author: 'content_team',
                reviewer: 'content_lead',
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString(),
                placeholders: [],
                notes: ''
            };
        }

        // –£—Ç–∏–ª–∏—Ç—ã
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function saveToLocalStorage() {
            try {
                localStorage.setItem('sleepover_cards_data', JSON.stringify(cardsData));
                console.log('üíæ LocalStorage Save:', `–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
            } catch (error) {
                console.error('üí• LocalStorage Save Error:', error);
            }
        }

        function loadFromLocalStorage() {
            const saved = localStorage.getItem('sleepover_cards_data');
            if (saved) {
                try {
                    cardsData = JSON.parse(saved);
                    console.log('üìÇ LocalStorage Load:', `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫ –∏–∑ localStorage`);
                    
                    // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                    cardsData.forEach((card, index) => {
                        const errors = validateCard(card, index);
                        if (errors.length > 0) {
                            console.warn(`‚ö†Ô∏è Loaded Card Invalid:`, errors);
                        }
                    });
                    
                    renderCardsList();
                    updateStats();
                } catch (e) {
                    console.error('üí• LocalStorage Parse Error:', e);
                    console.warn('üîÑ Resetting to empty array due to parse error');
                    cardsData = [];
                }
            } else {
                console.log('üìÇ LocalStorage Load: –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
            }
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        function validateCard(card, index = null) {
            const errors = [];
            const cardPrefix = index !== null ? `–ö–∞—Ä—Ç–æ—á–∫–∞ ${index + 1}` : '–ö–∞—Ä—Ç–æ—á–∫–∞';

            try {
                if (!card.catalog_id?.trim()) {
                    const error = `${cardPrefix}: Catalog ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.set_id) {
                    const error = `${cardPrefix}: Set ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.category) {
                    const error = `${cardPrefix}: Category –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.call_to_action?.primary) {
                    const error = `${cardPrefix}: Primary Action –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.call_to_action?.secondary) {
                    const error = `${cardPrefix}: Secondary Action –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.locale_text?.ru?.trim()) {
                    const error = `${cardPrefix}: –¢–µ–∫—Å—Ç –Ω–∞ —Ä—É—Å—Å–∫–æ–º –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.target_player) {
                    const error = `${cardPrefix}: Target Player –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (!card.tags?.segment?.[0]) {
                    const error = `${cardPrefix}: Segment –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (card.depth < 1 || card.depth > 5) {
                    const error = `${cardPrefix}: Depth –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 1 –¥–æ 5 (—Ç–µ–∫—É—â–∏–π: ${card.depth})`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (card.spice < 0 || card.spice > 3) {
                    const error = `${cardPrefix}: Spice –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 3 (—Ç–µ–∫—É—â–∏–π: ${card.spice})`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (card.weight <= 0) {
                    const error = `${cardPrefix}: Weight –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0 (—Ç–µ–∫—É—â–∏–π: ${card.weight})`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }
                
                if (card.eligibility?.min_age < 7 || card.eligibility?.min_age > 25) {
                    const error = `${cardPrefix}: Min Age –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 7 –¥–æ 25 (—Ç–µ–∫—É—â–∏–π: ${card.eligibility?.min_age})`;
                    errors.push(error);
                    console.warn('üîç Validation Error:', error, card);
                }

                // –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫
                if (errors.length === 0) {
                    console.log('‚úÖ Validation Success:', `${cardPrefix} –ø—Ä–æ—à–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—é`);
                }

            } catch (error) {
                console.error('üí• Critical Validation Error:', error, card);
                errors.push(`${cardPrefix}: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏`);
            }

            return errors;
        }

        function showValidationErrors(errors) {
            const summary = document.getElementById('validationSummary');
            const list = document.getElementById('validationList');
            
            if (errors.length > 0) {
                list.innerHTML = errors.map(error => `<li>${error}</li>`).join('');
                summary.style.display = 'block';
            } else {
                summary.style.display = 'none';
            }
        }

        function validateFormField(fieldName, value) {
            const formGroup = document.querySelector(`#${fieldName}`).closest('.form-group');
            let isValid = true;

            switch (fieldName) {
                case 'catalog_id':
                case 'text_ru':
                    isValid = value?.trim().length > 0;
                    break;
                case 'set_id':
                case 'category':
                case 'primary':
                case 'secondary':
                case 'target_player':
                case 'segment':
                    isValid = value !== '';
                    break;
                case 'depth':
                    isValid = value >= 1 && value <= 5;
                    break;
                case 'spice':
                    isValid = value >= 0 && value <= 3;
                    break;
                case 'weight':
                    isValid = value > 0;
                    break;
                case 'min_age':
                    isValid = value >= 7 && value <= 25;
                    break;
                default:
                    isValid = true;
            }

            if (formGroup) {
                formGroup.classList.toggle('error', !isValid);
            }

            return isValid;
        }

        // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
        function renderCardsList() {
            const list = document.getElementById('cardsList');
            list.innerHTML = '';

            console.log('üé® Rendering Cards List:', `–û—Ç–æ–±—Ä–∞–∂–∞–µ–º ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);

            cardsData.forEach((card, index) => {
                try {
                    const errors = validateCard(card, index);
                    const isValid = errors.length === 0;

                    const cardElement = document.createElement('div');
                    cardElement.className = `card-item ${index === currentCardIndex ? 'active' : ''} ${!isValid ? 'invalid' : ''}`;
                    cardElement.onclick = () => selectCard(index);

                    const preview = card.locale_text?.ru || '–ù–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞';
                    const category = card.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                    const setId = card.set_id || '–ë–µ–∑ –Ω–∞–±–æ—Ä–∞';

                    cardElement.innerHTML = `
                        <div class="card-preview">
                            <div class="card-meta">
                                <span>${category}</span>
                                <span>${setId}</span>
                            </div>
                            <div class="card-text">${preview}</div>
                            <div class="card-tags">
                                ${card.target_player || 'No target'} ‚Ä¢ 
                                depth:${card.depth} ‚Ä¢ 
                                spice:${card.spice}
                                ${!isValid ? ' ‚Ä¢ ‚ö†Ô∏è –û—à–∏–±–∫–∏' : ''}
                            </div>
                        </div>
                        <button class="delete-card" onclick="deleteCard(${index}); event.stopPropagation();">√ó</button>
                    `;

                    list.appendChild(cardElement);

                    if (!isValid) {
                        console.warn(`‚ö†Ô∏è Card ${index + 1} Invalid:`, errors);
                    }
                } catch (error) {
                    console.error(`üí• Render Error for card ${index + 1}:`, error, card);
                }
            });
        }

        function updateStats() {
            try {
                const total = cardsData.length;
                const valid = cardsData.filter(card => validateCard(card).length === 0).length;
                const invalid = total - valid;

                document.getElementById('totalCards').textContent = total;
                document.getElementById('validCards').textContent = valid;
                document.getElementById('invalidCards').textContent = invalid;

                console.log('üìä Stats Updated:', {
                    total: total,
                    valid: valid,
                    invalid: invalid
                });
            } catch (error) {
                console.error('üí• Stats Update Error:', error);
            }
        }

        // –í—ã–±–æ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏
        function selectCard(index) {
            try {
                console.log(`üéØ Selecting Card:`, index + 1, cardsData[index]);
                
                currentCardIndex = index;
                renderCardsList();
                populateForm();
                updateJSON();

                document.getElementById('noCardSelected').style.display = 'none';
                document.getElementById('cardEditor').style.display = 'block';
                document.getElementById('downloadSingleBtn').disabled = false;

                console.log(`‚úÖ Card Selected:`, `–ö–∞—Ä—Ç–æ—á–∫–∞ ${index + 1} –∞–∫—Ç–∏–≤–Ω–∞`);
            } catch (error) {
                console.error('üí• Card Selection Error:', error, index);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        function addNewCard() {
            try {
                const newCard = createNewCard();
                cardsData.push(newCard);
                console.log('‚ûï New Card Added:', newCard.id, newCard);
                
                selectCard(cardsData.length - 1);
                saveToLocalStorage();
                updateStats();
            } catch (error) {
                console.error('üí• Add Card Error:', error);
            }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        function deleteCard(index) {
            try {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É?')) {
                    const deletedCard = cardsData[index];
                    console.log('üóëÔ∏è Deleting Card:', index + 1, deletedCard);
                    
                    cardsData.splice(index, 1);
                    
                    if (currentCardIndex === index) {
                        currentCardIndex = -1;
                        document.getElementById('noCardSelected').style.display = 'flex';
                        document.getElementById('cardEditor').style.display = 'none';
                        document.getElementById('downloadSingleBtn').disabled = true;
                    } else if (currentCardIndex > index) {
                        currentCardIndex--;
                    }
                    
                    renderCardsList();
                    updateStats();
                    saveToLocalStorage();
                    updateJSON();

                    console.log('‚úÖ Card Deleted:', `–£–¥–∞–ª–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞ ${index + 1}`);
                }
            } catch (error) {
                console.error('üí• Delete Card Error:', error, index);
            }
        }

        // Multi-select —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
        function initMultiSelect() {
            document.querySelectorAll('.multi-select').forEach(container => {
                const field = container.dataset.field;
                const selectContainer = container.querySelector('.multi-select-container');
                const selectedItems = container.querySelector('.selected-items');
                const dropdown = container.querySelector('.dropdown-options');

                selectContainer.addEventListener('click', () => {
                    dropdown.classList.toggle('active');
                });

                dropdown.addEventListener('click', (e) => {
                    if (e.target.classList.contains('dropdown-option')) {
                        const value = e.target.dataset.value;
                        toggleSelection(field, value, container);
                    }
                });

                document.addEventListener('click', (e) => {
                    if (!container.contains(e.target)) {
                        dropdown.classList.remove('active');
                    }
                });
            });
        }

        function toggleSelection(field, value, container) {
            if (currentCardIndex === -1) return;

            const selectedItems = container.querySelector('.selected-items');
            let currentValues = [];

            // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
            if (field === 'tone' || field === 'occasion' || field === 'season') {
                currentValues = cardsData[currentCardIndex].tags[field] || [];
            } else if (field === 'countries_allow' || field === 'languages') {
                currentValues = cardsData[currentCardIndex].eligibility[field] || [];
            }

            // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
            const index = currentValues.indexOf(value);
            if (index > -1) {
                currentValues.splice(index, 1);
            } else {
                currentValues.push(value);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (field === 'tone' || field === 'occasion' || field === 'season') {
                cardsData[currentCardIndex].tags[field] = currentValues;
            } else if (field === 'countries_allow' || field === 'languages') {
                cardsData[currentCardIndex].eligibility[field] = currentValues;
            }

            updateSelectedItems(field, container);
            renderCardsList();
            updateJSON();
            saveToLocalStorage();
        }

        function updateSelectedItems(field, container) {
            if (currentCardIndex === -1) return;

            const selectedItems = container.querySelector('.selected-items');
            let currentValues = [];

            if (field === 'tone' || field === 'occasion' || field === 'season') {
                currentValues = cardsData[currentCardIndex].tags[field] || [];
            } else if (field === 'countries_allow' || field === 'languages') {
                currentValues = cardsData[currentCardIndex].eligibility[field] || [];
            }

            selectedItems.innerHTML = currentValues.map(value => `
                <div class="selected-item">
                    ${value}
                    <span class="remove" onclick="removeSelection('${field}', '${value}')">√ó</span>
                </div>
            `).join('');

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ü–∏–π
            container.querySelectorAll('.dropdown-option').forEach(option => {
                option.classList.toggle('selected', currentValues.includes(option.dataset.value));
            });
        }

        function removeSelection(field, value) {
            if (currentCardIndex === -1) return;

            let currentValues = [];

            if (field === 'tone' || field === 'occasion' || field === 'season') {
                currentValues = cardsData[currentCardIndex].tags[field] || [];
            } else if (field === 'countries_allow' || field === 'languages') {
                currentValues = cardsData[currentCardIndex].eligibility[field] || [];
            }

            const index = currentValues.indexOf(value);
            if (index > -1) {
                currentValues.splice(index, 1);
            }

            if (field === 'tone' || field === 'occasion' || field === 'season') {
                cardsData[currentCardIndex].tags[field] = currentValues;
            } else if (field === 'countries_allow' || field === 'languages') {
                cardsData[currentCardIndex].eligibility[field] = currentValues;
            }

            const container = document.querySelector(`[data-field="${field}"]`);
            updateSelectedItems(field, container);
            renderCardsList();
            updateJSON();
            saveToLocalStorage();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ JSON
        function updateJSON() {
            if (currentCardIndex === -1) {
                document.getElementById('jsonOutput').value = JSON.stringify(cardsData, null, 2);
            } else {
                cardsData[currentCardIndex].updated_at = new Date().toISOString();
                const card = cardsData[currentCardIndex];
                const errors = validateCard(card);
                showValidationErrors(errors);
                document.getElementById('jsonOutput').value = JSON.stringify(card, null, 2);
            }
        }

        // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã
        function populateForm() {
            if (currentCardIndex === -1) return;

            const card = cardsData[currentCardIndex];
            
            document.getElementById('id').value = card.id || '';
            document.getElementById('catalog_id').value = card.catalog_id || '';
            document.getElementById('set_id').value = card.set_id || '';
            document.getElementById('category').value = card.category || '';
            document.getElementById('primary').value = card.call_to_action?.primary || '';
            document.getElementById('secondary').value = card.call_to_action?.secondary || '';
            document.getElementById('depth').value = card.depth || '';
            document.getElementById('spice').value = card.spice || '';
            document.getElementById('weight').value = card.weight || '';
            document.getElementById('target_player').value = card.target_player || '';
            document.getElementById('text_ru').value = card.locale_text?.ru || '';
            document.getElementById('text_en').value = card.locale_text?.en || '';
            document.getElementById('placeholders').value = (card.placeholders || []).join(', ');
            document.getElementById('segment').value = card.tags?.segment?.[0] || '';
            document.getElementById('min_age').value = card.eligibility?.min_age || '';
            document.getElementById('notes').value = card.notes || '';

            // –û–±–Ω–æ–≤–ª—è–µ–º multi-select –ø–æ–ª—è
            document.querySelectorAll('.multi-select').forEach(container => {
                const field = container.dataset.field;
                updateSelectedItems(field, container);
            });

            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π
            const errors = validateCard(card);
            showValidationErrors(errors);
            
            updateJSON();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –ø–æ–ª–µ–π
        function attachEventListeners() {
            const fields = [
                'catalog_id', 'set_id', 'category', 'primary', 'secondary',
                'depth', 'spice', 'weight', 'target_player', 'text_ru', 'text_en',
                'segment', 'min_age', 'notes'
            ];

            fields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    element.addEventListener('input', (e) => {
                        validateFormField(field, e.target.value);
                        updateField(field, e.target.value);
                    });
                }
            });

            // –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
            document.getElementById('placeholders').addEventListener('input', (e) => {
                if (currentCardIndex === -1) return;
                const placeholders = e.target.value.split(',').map(p => p.trim()).filter(p => p);
                cardsData[currentCardIndex].placeholders = placeholders;
                renderCardsList();
                updateJSON();
                saveToLocalStorage();
            });
        }

        function updateField(field, value) {
            if (currentCardIndex === -1) return;

            const card = cardsData[currentCardIndex];

            if (field === 'primary' || field === 'secondary') {
                card.call_to_action[field] = value;
            } else if (field === 'text_ru') {
                card.locale_text.ru = value;
            } else if (field === 'text_en') {
                card.locale_text.en = value;
            } else if (field === 'segment') {
                card.tags.segment = [value];
            } else if (field === 'min_age') {
                card.eligibility.min_age = parseInt(value) || 7;
            } else if (field === 'depth' || field === 'spice' || field === 'weight') {
                card[field] = parseFloat(value) || 0;
            } else {
                card[field] = value;
            }

            renderCardsList();
            updateJSON();
            saveToLocalStorage();
            updateStats();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('addCardBtn').addEventListener('click', addNewCard);

        document.getElementById('downloadBtn').addEventListener('click', () => {
            try {
                console.log('üíæ Downloading All Cards:', `–°–∫–∞—á–∏–≤–∞–µ–º ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
                
                // –í—ã–≥—Ä—É–∂–∞–µ–º –∫–∞–∫ –º–∞—Å—Å–∏–≤ –∫–∞—Ä—Ç–æ—á–µ–∫
                const jsonString = JSON.stringify(cardsData, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sleepover-cards-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('‚úÖ Download Success:', '–í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–∫–∞—á–∞–Ω—ã');
            } catch (error) {
                console.error('üí• Download All Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + error.message);
            }
        });

        document.getElementById('downloadSingleBtn').addEventListener('click', () => {
            try {
                if (currentCardIndex === -1) return;
                const card = cardsData[currentCardIndex];
                
                console.log('üíæ Downloading Single Card:', card.id, card);
                
                const jsonString = JSON.stringify(card, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `sleepover-card-${card.id}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                console.log('‚úÖ Single Download Success:', `–ö–∞—Ä—Ç–æ—á–∫–∞ ${card.id} —Å–∫–∞—á–∞–Ω–∞`);
            } catch (error) {
                console.error('üí• Download Single Error:', error);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏: ' + error.message);
            }
        });

        document.getElementById('copyBtn').addEventListener('click', () => {
            try {
                // –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ –∫–∞—Ä—Ç–æ—á–µ–∫, –∞ –Ω–µ –æ–¥–Ω—É –∫–∞—Ä—Ç–æ—á–∫—É
                const jsonString = JSON.stringify(cardsData, null, 2);
                
                console.log('üìã Copying to Clipboard:', `–ö–æ–ø–∏—Ä—É–µ–º ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
                
                navigator.clipboard.writeText(jsonString).then(() => {
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.textContent;
                    btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
                    btn.style.background = '#28a745';
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.style.background = '#6c757d';
                    }, 2000);

                    console.log('‚úÖ Copy Success:', '–ö–∞—Ä—Ç–æ—á–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä');
                }).catch(error => {
                    console.error('üí• Copy Error:', error);
                    alert('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message);
                });
            } catch (error) {
                console.error('üí• Copy Preparation Error:', error);
            }
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ JSON —Ñ–∞–π–ª–∞
        document.getElementById('jsonFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                console.log('üìÇ Loading File:', file.name, `${file.size} bytes`);
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        console.log('üìÑ File Parsed:', jsonData);
                        
                        // –í—Å–µ–≥–¥–∞ –æ–∂–∏–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –∫–∞—Ä—Ç–æ—á–µ–∫
                        if (Array.isArray(jsonData)) {
                            console.log('üìã Loading Array:', `${jsonData.length} –∫–∞—Ä—Ç–æ—á–µ–∫`);
                            cardsData = jsonData.map((card, index) => {
                                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º UUID –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                                if (!card.id) {
                                    card.id = generateUUID();
                                    console.log(`üîß Generated UUID for card ${index + 1}:`, card.id);
                                }
                                return card;
                            });
                        } else {
                            console.log('üìÑ Loading Single Card, converting to array');
                            // –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞, –¥–µ–ª–∞–µ–º –º–∞—Å—Å–∏–≤ –∏–∑ –Ω–µ—ë
                            if (!jsonData.id) {
                                jsonData.id = generateUUID();
                                console.log('üîß Generated UUID for single card:', jsonData.id);
                            }
                            cardsData = [jsonData];
                        }
                        
                        // –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                        let totalErrors = 0;
                        cardsData.forEach((card, index) => {
                            const errors = validateCard(card, index);
                            totalErrors += errors.length;
                        });

                        console.log('üîç Validation Complete:', {
                            totalCards: cardsData.length,
                            totalErrors: totalErrors,
                            validCards: cardsData.filter(card => validateCard(card).length === 0).length
                        });
                        
                        currentCardIndex = -1;
                        renderCardsList();
                        updateStats();
                        saveToLocalStorage();
                        
                        document.getElementById('noCardSelected').style.display = 'flex';
                        document.getElementById('cardEditor').style.display = 'none';
                        document.getElementById('downloadSingleBtn').disabled = true;
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                        const header = document.querySelector('.header p');
                        const originalText = header.textContent;
                        const message = totalErrors > 0 
                            ? `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫ (${totalErrors} –æ—à–∏–±–æ–∫)`
                            : `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${cardsData.length} –∫–∞—Ä—Ç–æ—á–µ–∫!`;
                        header.textContent = message;
                        header.style.color = totalErrors > 0 ? '#ffc107' : '#28a745';
                        
                        setTimeout(() => {
                            header.textContent = originalText;
                            header.style.color = 'rgba(255, 255, 255, 0.9)';
                        }, 5000);

                        console.log('‚úÖ File Load Success:', `–§–∞–π–ª ${file.name} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω`);
                        
                    } catch (error) {
                        console.error('üí• JSON Parse Error:', error, e.target.result);
                        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ JSON —Ñ–∞–π–ª–∞: ' + error.message);
                    }
                };

                reader.onerror = (error) => {
                    console.error('üí• File Read Error:', error);
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
                };

                reader.readAsText(file);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            loadFromLocalStorage();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
            initMultiSelect();
            attachEventListeners();
            updateStats();
            
            // –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ –Ω–µ—Ç, —Å–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—É—é
            if (cardsData.length === 0) {
                addNewCard();
            }
            
            console.log('üåô Sleepover Cards Editor –∑–∞–≥—Ä—É–∂–µ–Ω!');
        });

        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è onclick –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
        window.removeSelection = removeSelection;
        window.deleteCard = deleteCard;
